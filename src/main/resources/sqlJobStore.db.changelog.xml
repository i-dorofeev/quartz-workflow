<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
				   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
				   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">

	<property name="jobid.datatype" value="varchar(37)" /> <!-- the size of UUID (1052e27a-869e-aefe-012e-ea091a7f9713) is 37 -->
	
	<changeSet id="201611221823" author="UNKNOWN">
		<createTable tableName="jobstore_data">
			<column name="id" type="${jobid.datatype}" />
			<column name="parent_id" type="${jobid.datatype}" />
			<column name="queue_name" type="varchar(255)" />
			<column name="execution_type" type="varchar(16)" />
			<column name="result" type="varchar(16)" />
			<column name="exception" type="varchar(16384)" />
			<column name="job_key" type="varchar(255)" />
			<column name="args" type="varchar(4096)" />
		</createTable>

		<createTable tableName="jobstore_hierarchy">
			<column name="job_id" type="${jobid.datatype}" />
			<column name="job_parent_id" type="${jobid.datatype}" />
		</createTable>

		<addUniqueConstraint tableName="jobstore_data" columnNames="id" />

		<addForeignKeyConstraint baseTableName="jobstore_hierarchy" baseColumnNames="job_id"
								 constraintName="fk_hierarchy_id"
								 referencedTableName="jobstore_data"
								 referencedColumnNames="id" />

		<addForeignKeyConstraint baseTableName="jobstore_hierarchy" baseColumnNames="job_parent_id"
								 constraintName="fk_hierarchy_parent_id"
								 referencedTableName="jobstore_data"
								 referencedColumnNames="id" />
	</changeSet>

</databaseChangeLog>
